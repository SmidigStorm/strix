const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/monaco-editor-RVWtspOX.js","assets/index-BPa091oV.js","assets/index-B1kYFHYN.css","assets/mouseTarget-CvDJkAPU.js","assets/monaco-editor-xnhJeWAr.css"])))=>i.map(i=>d[i]);
import{e as h,U as v,l as m}from"./monaco-editor-RVWtspOX.js";import{a as M,b as f,_ as T,C as r}from"./index-BPa091oV.js";import"./mouseTarget-CvDJkAPU.js";const x=120*1e3;class F{_defaults;_idleCheckInterval;_lastUsedTime=0;_configChangeListener;_worker=null;_client=null;constructor(e){this._defaults=e,this._idleCheckInterval=window.setInterval(()=>this._checkIfIdle(),30*1e3),this._configChangeListener=this._defaults.onDidChange(()=>{this._stopWorker()})}_stopWorker(){this._worker&&(this._worker.dispose(),this._worker=null),this._client=null}dispose(){clearInterval(this._idleCheckInterval),this._configChangeListener.dispose(),this._stopWorker()}_checkIfIdle(){if(!this._worker)return;Date.now()-this._lastUsedTime>x&&this._stopWorker()}async _getClient(){if(this._lastUsedTime=Date.now(),!this._client&&!this._worker)try{const{languageId:e,formattingOptions:s,schemas:c,externalFragmentDefinitions:a,completionSettings:l}=this._defaults;this._worker=h.createWebWorker({moduleId:"monaco-graphql/esm/GraphQLWorker.js",label:e,createData:{languageId:e,formattingOptions:s,languageConfig:{schemas:c?.map(M),externalFragmentDefinitions:a,fillLeafsOnComplete:l.__experimental__fillLeafsOnComplete}}}),this._client=this._worker.getProxy()}catch(e){console.error("error loading worker",e)}return this._client}async getLanguageServiceWorker(...e){const s=await this._getClient();return await this._worker.withSyncedResources(e),s}}class b{defaults;_worker;_disposables=[];_listener=Object.create(null);constructor(e,s){this.defaults=e,this._worker=s,this._worker=s;let c;const a=t=>{const d=f(t);if(d!==this.defaults.languageId)return;const g=t.uri.toString(),u=e.diagnosticSettings.validateVariablesJSON?.[g];c=setTimeout(()=>{this._doValidate(t.uri,d,u)},400),this._listener[g]=t.onDidChangeContent(()=>{clearTimeout(c),c=setTimeout(()=>{this._doValidate(t.uri,d,u)},400)})},l=t=>{h.setModelMarkers(t,this.defaults.languageId,[]);const d=t.uri.toString(),g=this._listener[d];g&&(g.dispose(),delete this._listener[d])};this._disposables.push(h.onDidCreateModel(a),{dispose(){clearTimeout(c)}},h.onWillDisposeModel(t=>{l(t)}),h.onDidChangeModelLanguage(t=>{l(t.model),a(t.model)}),{dispose:()=>{for(const t of Object.values(this._listener))t.dispose()}},e.onDidChange(()=>{for(const t of h.getModels())f(t)===this.defaults.languageId&&(l(t),a(t))}));for(const t of h.getModels())f(t)===this.defaults.languageId&&a(t)}dispose(){for(const e of this._disposables)e.dispose();this._disposables=[]}async _doValidate(e,s,c){const a=await this._worker(e);if(!a)return;const l=await a.doValidation(e.toString());if(h.setModelMarkers(h.getModel(e),s,l),c){if(await T(()=>import("./monaco-editor-RVWtspOX.js").then(p=>p.a),__vite__mapDeps([0,1,2,3,4])),!c.length)throw new Error("No variables URI strings provided to validate");const t=await a.doGetVariablesJSONSchema(e.toString());if(!t)return;const d=v.file(c[0].replace(".json","-schema.json")).toString(),g={uri:d,schema:t,fileMatch:c},u=m.json.jsonDefaults.diagnosticsOptions.schemas?.filter(p=>p.uri!==d)||[];m.json.jsonDefaults.setDiagnosticsOptions({schemaValidation:"error",validate:!0,...this.defaults.diagnosticSettings.jsonDiagnosticSettings,schemas:[...u,g],enableSchemaRequest:!1})}}}const i=m.CompletionItemKind,C={[r.Text]:i.Text,[r.Method]:i.Method,[r.Function]:i.Function,[r.Constructor]:i.Constructor,[r.Field]:i.Field,[r.Variable]:i.Variable,[r.Class]:i.Class,[r.Interface]:i.Interface,[r.Module]:i.Module,[r.Property]:i.Property,[r.Unit]:i.Unit,[r.Value]:i.Value,[r.Enum]:i.Enum,[r.Keyword]:i.Keyword,[r.Snippet]:i.Snippet,[r.Color]:i.Color,[r.File]:i.File,[r.Reference]:i.Reference,[r.Folder]:i.Folder,[r.EnumMember]:i.EnumMember,[r.Constant]:i.Constant,[r.Struct]:i.Struct,[r.Event]:i.Event,[r.Operator]:i.Operator,[r.TypeParameter]:i.TypeParameter};function E(o){return o in C?C[o]:i.Text}function O(o){return{range:o.range,kind:E(o.kind),label:o.label,insertText:o.insertText??o.label,insertTextRules:o.insertText?m.CompletionItemInsertTextRule.InsertAsSnippet:void 0,sortText:o.sortText,filterText:o.filterText,documentation:o.documentation,detail:o.detail,command:o.command}}class L{_worker;constructor(e){this._worker=e,this._worker=e}get triggerCharacters(){return[":","$"," ","(","@"]}async provideCompletionItems(e,s,c,a){try{return{incomplete:!0,suggestions:(await(await this._worker(e.uri)).doComplete(e.uri.toString(),s)).map(O)}}catch(l){return console.error("Error fetching completion items",l),{suggestions:[]}}}}class P{_worker;constructor(e){this._worker=e,this._worker=e}async provideDocumentFormattingEdits(e,s,c){const l=await(await this._worker(e.uri)).doFormat(e.uri.toString());return l?[{range:e.getFullModelRange(),text:l}]:[]}}class V{_worker;constructor(e){this._worker=e}async provideHover(e,s,c){const a=e.uri,t=await(await this._worker(e.uri)).doHover(a.toString(),s);return t?{range:t.range,contents:[{value:t.content}]}:{contents:[]}}dispose(){}}function W(o){const e=[],s=[],c=new F(o);e.push(c);const a=(...n)=>{try{return c.getLanguageServiceWorker(...n)}catch{throw new Error("Error fetching graphql language service worker")}};function l(){const{modeConfiguration:n,languageId:_}=o;n.documentFormattingEdits&&s.push(m.registerDocumentFormattingEditProvider(_,new P(a)))}function t(n){const{modeConfiguration:_,languageId:w}=o;S(s),_.completionItems&&s.push(m.registerCompletionItemProvider(w,new L(a))),_.diagnostics&&s.push(new b(n,a)),_.hovers&&s.push(m.registerHoverProvider(w,new V(a))),l()}let{modeConfiguration:d,formattingOptions:g,diagnosticSettings:u,externalFragmentDefinitions:p,schemas:k}=o;return t(o),o.onDidChange(n=>{n.modeConfiguration!==d&&(d=n.modeConfiguration,t(n)),n.formattingOptions!==g&&(g=n.formattingOptions,l()),n.externalFragmentDefinitions!==p&&(p=n.externalFragmentDefinitions,t(n)),n.diagnosticSettings!==u&&(u=n.diagnosticSettings,t(n)),n.schemas!==k&&(k=n.schemas,t(n))}),e.push(I(s)),I(e)}function I(o){return{dispose:()=>S(o)}}function S(o){for(;o.length;)o.pop().dispose()}export{W as setupMode};
